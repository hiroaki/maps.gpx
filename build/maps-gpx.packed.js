function MapsGPX(){this.initialize.apply(this,arguments)}function DrawerCSS(){this.initialize.apply(this,arguments)}function ExtDraggableObject(e,t){function n(t){t?e.style.cursor=_:e.style.cursor=E}function i(t,n,i){var o,r;f=Math.round(t),d=Math.round(n),G.intervalX>1&&(o=Math.round(f%G.intervalX),f=T>o?f-o:f+(G.intervalX-o)),G.intervalY>1&&(r=Math.round(d%G.intervalY),d=S>r?d-r:d+(G.intervalY-r)),G.container&&G.container.offsetWidth&&(f=Math.max(0,Math.min(f,G.container.offsetWidth-e.offsetWidth)),d=Math.max(0,Math.min(d,G.container.offsetHeight-e.offsetHeight))),"number"==typeof l&&(f-l>G.toleranceX||l-(f+e.offsetWidth)>G.toleranceX||d-p>G.toleranceY||p-(d+e.offsetHeight)>G.toleranceY)&&(f=P,d=M),G.restrictX||i||(e.style.left=f+"px"),G.restrictY||i||(e.style.top=d+"px")}function o(e){var t=e||event;l=c+((t.pageX||t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft)-u),p=h+((t.pageY||t.clientY+document.body.scrollTop+document.documentElement.scrollTop)-g),c=l,h=p,u=t.pageX||t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g=t.pageY||t.clientY+document.body.scrollTop+document.documentElement.scrollTop,X&&(i(l,p,s),w.trigger(b,"drag",{mouseX:u,mouseY:g,startLeft:P,startTop:M,event:t}))}function r(t){var i=t||event;return n(!0),w.trigger(b,"mousedown",i),"absolute"!==e.style.position?void(e.style.position="absolute"):(u=i.pageX||i.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g=i.pageY||i.clientY+document.body.scrollTop+document.documentElement.scrollTop,P=e.offsetLeft,M=e.offsetTop,c=P,h=M,v=w.addDomListener(x,"mousemove",o),e.setCapture&&e.setCapture(),i.preventDefault?(i.preventDefault(),i.stopPropagation()):(i.cancelBubble=!0,i.returnValue=!1),X=!0,void w.trigger(b,"dragstart",{mouseX:u,mouseY:g,startLeft:P,startTop:M,event:i}))}function a(t){var i=t||event;X&&(n(!1),w.removeListener(v),e.releaseCapture&&e.releaseCapture(),X=!1,w.trigger(b,"dragend",{mouseX:u,mouseY:g,startLeft:P,startTop:M,event:i})),l=p=null,w.trigger(b,"mouseup",i)}var s,l,p,h,c,u,g,d,f,m,y,v,P,M,b=this,w=window.GEvent||google.maps.Event||google.maps.event,G=t||{},_=G.draggingCursor||"default",E=G.draggableCursor||"default",X=!1,T=Math.round(G.intervalX/2),S=Math.round(G.intervalY/2),x=e.setCapture?e:document;"number"!=typeof G.intervalX&&(G.intervalX=1),"number"!=typeof G.intervalY&&(G.intervalY=1),"number"!=typeof G.toleranceX&&(G.toleranceX=1/0),"number"!=typeof G.toleranceY&&(G.toleranceY=1/0),m=w.addDomListener(e,"mousedown",r),y=w.addDomListener(x,"mouseup",a),n(!1),G.container,e.style.position="absolute",G.left=G.left||e.offsetLeft,G.top=G.top||e.offsetTop,G.interval=G.interval||1,i(G.left,G.top,!1),b.moveTo=function(e){i(e.x,e.y,!1)},b.moveBy=function(t){i(e.offsetLeft+t.width,e.offsetHeight+t.height,!1)},b.setDraggingCursor=function(e){_=e,n(X)},b.setDraggableCursor=function(e){E=e,n(X)},b.left=function(){return f},b.top=function(){return d},b.valueX=function(){var e=G.intervalX||1;return Math.round(f/e)},b.valueY=function(){var e=G.intervalY||1;return Math.round(d/e)},b.setValueX=function(e){i(e*G.intervalX,d,!1)},b.setValueY=function(e){i(f,e*G.intervalY,!1)},b.preventDefaultMovement=function(e){s=e}}function MercatorProjection(){this.pixelOrigin_=new google.maps.Point(MercatorProjection.TILE_SIZE/2,MercatorProjection.TILE_SIZE/2),this.pixelsPerLonDegree_=MercatorProjection.TILE_SIZE/360,this.pixelsPerLonRadian_=MercatorProjection.TILE_SIZE/(2*Math.PI)}!function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var h=n[a]={exports:{}};t[a][0].call(h.exports,function(e){var n=t[a][1][e];return o(n?n:e)},h,h.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";function i(){}function o(e){try{return e.then}catch(t){return m=t,y}}function r(e,t){try{return e(t)}catch(n){return m=n,y}}function a(e,t,n){try{e(t,n)}catch(i){return m=i,y}}function s(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],e!==i&&d(e,this)}function l(e,t,n){return new e.constructor(function(o,r){var a=new s(i);a.then(o,r),p(e,new g(t,n,a))})}function p(e,t){for(;3===e._37;)e=e._12;return 0===e._37?void e._59.push(t):void f(function(){var n=1===e._37?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._37?h(t.promise,e._12):c(t.promise,e._12));var i=r(n,e._12);i===y?c(t.promise,m):h(t.promise,i)})}function h(e,t){if(t===e)return c(e,new TypeError("A promise cannot be resolved with itself."));if(t&&("object"==typeof t||"function"==typeof t)){var n=o(t);if(n===y)return c(e,m);if(n===e.then&&t instanceof s)return e._37=3,e._12=t,void u(e);if("function"==typeof n)return void d(n.bind(t),e)}e._37=1,e._12=t,u(e)}function c(e,t){e._37=2,e._12=t,u(e)}function u(e){for(var t=0;t<e._59.length;t++)p(e,e._59[t]);e._59=null}function g(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function d(e,t){var n=!1,i=a(e,function(e){n||(n=!0,h(t,e))},function(e){n||(n=!0,c(t,e))});n||i!==y||(n=!0,c(t,m))}var f=e("asap/raw"),m=null,y={};t.exports=s,s._99=i,s.prototype.then=function(e,t){if(this.constructor!==s)return l(this,e,t);var n=new s(i);return p(this,new g(e,t,n)),n}},{"asap/raw":4}],2:[function(e,t,n){"use strict";function i(e){var t=new o(o._99);return t._37=1,t._12=e,t}var o=e("./core.js");t.exports=o;var r=i(!0),a=i(!1),s=i(null),l=i(void 0),p=i(0),h=i("");o.resolve=function(e){if(e instanceof o)return e;if(null===e)return s;if(void 0===e)return l;if(e===!0)return r;if(e===!1)return a;if(0===e)return p;if(""===e)return h;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new o(t.bind(e))}catch(n){return new o(function(e,t){t(n)})}return i(e)},o.all=function(e){var t=Array.prototype.slice.call(e);return new o(function(e,n){function i(a,s){if(s&&("object"==typeof s||"function"==typeof s)){if(s instanceof o&&s.then===o.prototype.then){for(;3===s._37;)s=s._12;return 1===s._37?i(a,s._12):(2===s._37&&n(s._12),void s.then(function(e){i(a,e)},n))}var l=s.then;if("function"==typeof l){var p=new o(l.bind(s));return void p.then(function(e){i(a,e)},n)}}t[a]=s,0===--r&&e(t)}if(0===t.length)return e([]);for(var r=t.length,a=0;a<t.length;a++)i(a,t[a])})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){e.forEach(function(e){o.resolve(e).then(t,n)})})},o.prototype["catch"]=function(e){return this.then(null,e)}},{"./core.js":1}],3:[function(e,t,n){"use strict";function i(){if(l.length)throw l.shift()}function o(e){var t;t=s.length?s.pop():new r,t.task=e,a(t)}function r(){this.task=null}var a=e("./raw"),s=[],l=[],p=a.makeRequestCallFromTimer(i);t.exports=o,r.prototype.call=function(){try{this.task.call()}catch(e){o.onerror?o.onerror(e):(l.push(e),p())}finally{this.task=null,s[s.length]=this}}},{"./raw":4}],4:[function(e,t,n){(function(e){"use strict";function n(e){s.length||(a(),l=!0),s[s.length]=e}function i(){for(;p<s.length;){var e=p;if(p+=1,s[e].call(),p>h){for(var t=0,n=s.length-p;n>t;t++)s[t]=s[t+p];s.length-=p,p=0}}s.length=0,p=0,l=!1}function o(e){var t=1,n=new c(e),i=document.createTextNode("");return n.observe(i,{characterData:!0}),function(){t=-t,i.data=t}}function r(e){return function(){function t(){clearTimeout(n),clearInterval(i),e()}var n=setTimeout(t,0),i=setInterval(t,50)}}t.exports=n;var a,s=[],l=!1,p=0,h=1024,c=e.MutationObserver||e.WebKitMutationObserver;a="function"==typeof c?o(i):r(i),n.requestFlush=a,n.makeRequestCallFromTimer=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,n){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(e,t){var n=arguments.length?this.then.apply(this,arguments):this;n.then(null,function(e){setTimeout(function(){throw e},0)})})},{}],6:[function(e,t,n){e("asap");"undefined"==typeof Promise&&(Promise=e("./lib/core.js"),e("./lib/es6-extensions.js")),e("./polyfill-done.js")},{"./lib/core.js":1,"./lib/es6-extensions.js":2,"./polyfill-done.js":5,asap:3}]},{},[6]),MapsGPX.VERSION="4.1.2",MapsGPX.EXTENSIONS=["GeoLocation","GeoLocationControl","DrawerCSS","DescImage","EXIF","EXIF2GPX","EXIFMarker","ElevationChart","Droppable","QueryURL","InputFileControl","SearchControl","Milestone","VertexInfo","VertexInfoWindow","SidePanelControl","FileClip","ToggleOverlay"],MapsGPX.ELEMENTS={AGEOFDGPSDATA:"ageofdgpsdata",AUTHOR:"author",BOUNDS:"bounds",CMT:"cmt",COPYRIGHT:"copyright",DESC:"desc",DGPSID:"dgpsid",ELE:"ele",EMAIL:"email",EXTENSIONS:"extensions",FIX:"fix",GEOIDHEIGHT:"geoidheight",GPX:"gpx",HDOP:"hdop",KEYWORDS:"keywords",LICENSE:"license",LINK:"link",MAGVAR:"magvar",METADATA:"metadata",NAME:"name",NUMBER:"number",PDOP:"pdop",PT:"pt",RTE:"rte",RTEPT:"rtept",SAT:"sat",SRC:"src",TEXT:"text",TIME:"time",TRK:"trk",TRKPT:"trkpt",TRKSEG:"trkseg",TYPE:"type",VDOP:"vdop",WPT:"wpt",YEAR:"year"},MapsGPX._sequence=0,MapsGPX.nextval=function(){return++MapsGPX._sequence},MapsGPX.strict=!0,MapsGPX.join_trkseg=!0,MapsGPX.cache_script=!0,MapsGPX.basedir=function(){var e,t,n,i=document.getElementsByTagName("script"),o=new RegExp("/maps-gpx.js.*");for(e=0,t=i.length;t>e;++e)if(n=i.item(e).getAttribute("src"),o.test(n))return n.replace(o,"");return"."}(),MapsGPX.plugin_dir=[MapsGPX.basedir,"plugins"].join("/"),MapsGPX.scrip_loader="loader.js",MapsGPX.style_loader="loader.css",MapsGPX.parseQueryString=function(e){var t,n,i,o,r,a={};if(e)for(t=e.match(/^\?/)?e.substring(1):e,n=t.split(/[;&]/),i=0,o=n.length;o>i;++i)r=n[i].split("="),r[0]&&(a[r[0]]=decodeURIComponent(r[1]));return a},MapsGPX.parseXML=function(e){if("undefined"!=typeof ActiveXObject&&"undefined"!=typeof GetObject){var t=new ActiveXObject("Microsoft.XMLDOM");return t.loadXML(e),t}if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(e,"text/xml");throw new Error("Cannot parse string as XML stream.")},MapsGPX.createXMLHttpRequest=function(){try{if("undefined"!=typeof ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP");if(window.XMLHttpRequest)return new XMLHttpRequest}catch(e){throw new Error("Cannot create XmlHttpRequest object.")}return null},MapsGPX.resolveAsBlob=function(e){return e instanceof Blob||e instanceof File?Promise.resolve(e):"string"==typeof e?new Promise(function(t,n){var i=MapsGPX.createXMLHttpRequest();i.open("GET",e,!0),i.responseType="blob",i.onload=function(e){4===this.readyState&&(200===this.status||0===this.status)&&t(this.response)},i.send()}):void 0},MapsGPX.resolveAsArrayBuffer=function(e){return MapsGPX.resolveAsBlob(e).then(function(e){return new Promise(function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsArrayBuffer(e)})})},MapsGPX.resolveAsObjectURL=function(e){return MapsGPX.resolveAsBlob(e).then(function(e){return new Promise(function(t,n){t(URL.createObjectURL(e))})})},MapsGPX.resolveAsDataURL=function(e){return MapsGPX.resolveAsBlob(e).then(function(e){return new Promise(function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsDataURL(e)})})},MapsGPX.resolveAsText=function(e,t){return MapsGPX.resolveAsBlob(e).then(function(e){return new Promise(function(n,i){var o=new FileReader;o.onload=function(e){n(e.target.result)},o.readAsText(e,t||"UTF-8")})})},MapsGPX.GPXToJSON=function(e){var t,n,i,o,r,a,s=function(e){var t,n,i={href:e.getAttribute("href")},o=e.childNodes;for(t=0,n=o.length;n>t;++t)o[t].firstChild&&(i[o[t].tagName]=o[t].firstChild.nodeValue);return i},l=function(e){var t,n,i,o={lat:e.getAttribute("lat"),lon:e.getAttribute("lon"),link:[]},r=e.childNodes;for(t=0,n=r.length;n>t;++t)i=r[t].tagName,i==MapsGPX.ELEMENTS.LINK?o[MapsGPX.ELEMENTS.LINK].push(s(r[t])):i!=MapsGPX.ELEMENTS.EXTENSIONS&&r[t].firstChild&&(o[r[t].tagName]=r[t].firstChild.nodeValue);return o},p=function(e){var t,n,i,o={rtept:[]},r=e.childNodes;for(t=0,n=r.length;n>t;++t)i=r[t].tagName,i==MapsGPX.ELEMENTS.RTEPT?o[MapsGPX.ELEMENTS.RTEPT].push(l(r[t])):i!=MapsGPX.ELEMENTS.EXTENSIONS&&r[t].firstChild&&(o[i]=r[t].firstChild.nodeValue);return o},h=function(e){var t,n,i,o={trkpt:[]},r=e.childNodes;for(t=0,n=r.length;n>t;++t)i=r[t].tagName,i==MapsGPX.ELEMENTS.TRKPT?o[MapsGPX.ELEMENTS.TRKPT].push(l(r[t])):i!=MapsGPX.ELEMENTS.EXTENSIONS&&r[t].firstChild&&(o[i]=r[t].firstChild.nodeValue);return o},c=function(e){var t,n,i,o={trkseg:[]},r=e.childNodes;for(t=0,n=r.length;n>t;++t)i=r[t].tagName,i==MapsGPX.ELEMENTS.TRKSEG?o[MapsGPX.ELEMENTS.TRKSEG].push(h(r[t])):i!=MapsGPX.ELEMENTS.EXTENSIONS&&r[t].firstChild&&(o[i]=r[t].firstChild.nodeValue);return o},u=function(e){var t,n,i,o,r={metadata:{},wpt:[],rte:[],trk:[]};if(MapsGPX.strict){if(r.version=e.getAttribute("version"),r.creator=e.getAttribute("creator"),"1.1"!=r.version)throw new Error("GPX document is formatted as unsupported version, it requires 1.1 only.");if(!r.creator)throw new Error('Element "gpx" does not have attribute "creator" that is required.')}for(t=e.childNodes,n=0,i=t.length;i>n;++n)o=t[n].tagName,o==MapsGPX.ELEMENTS.WPT?r[MapsGPX.ELEMENTS.WPT].push(l(t[n])):o==MapsGPX.ELEMENTS.RTE?r[MapsGPX.ELEMENTS.RTE].push(p(t[n])):o==MapsGPX.ELEMENTS.TRK?r[MapsGPX.ELEMENTS.TRK].push(c(t[n])):o!=MapsGPX.ELEMENTS.EXTENSIONS&&o!=MapsGPX.ELEMENTS.METADATA&&t[n].firstChild&&(r[o]=t[n].firstChild.nodeValue);return r};for(r=u(e.getElementsByTagName(MapsGPX.ELEMENTS.GPX)[0]),a=MapsGPX.boundsOf(r.wpt,a),t=0,n=r.rte.length;n>t;++t)a=MapsGPX.boundsOf(r.rte[t].rtept,a);for(t=0,n=r.trk.length;n>t;++t)for(i=0,o=r.trk[t].trkseg.length;o>i;++i)a=MapsGPX.boundsOf(r.trk[t].trkseg[i].trkpt,a);return r.metadata[MapsGPX.ELEMENTS.BOUNDS]=a,r},MapsGPX.boundsOf=function(e,t){var n,i;for(t=t||{minlat:90,maxlat:-90,minlon:180,maxlon:-180},n=0,i=e.length;i>n;++n)e[n].lat<t.minlat&&(t.minlat=e[n].lat),t.maxlat<e[n].lat&&(t.maxlat=e[n].lat),e[n].lon<t.minlon&&(t.minlon=e[n].lon),t.maxlon<e[n].lon&&(t.maxlon=e[n].lon);return t},MapsGPX.LatLngBounds=function(e,t){this["super"]=google.maps.LatLngBounds.prototype,this.object_id="MapsGPX.LatLngBounds#"+MapsGPX.LatLngBounds.nextval(),google.maps.LatLngBounds.apply(this,arguments)},MapsGPX.LatLngBounds._sequence=0,MapsGPX.LatLngBounds.nextval=function(){return++MapsGPX.LatLngBounds._sequence},MapsGPX.LatLngBounds.prototype=Object.create(google.maps.LatLngBounds.prototype,{constructor:{value:MapsGPX.LatLngBounds}}),MapsGPX.LatLngBounds.prototype.clone=function(){return new MapsGPX.LatLngBounds(this.getSouthWest(),this.getNorthEast())},MapsGPX.Marker=function(e,t,n){var i=t,o=n||{};this["super"]=google.maps.Marker.prototype,this._element=e,this._source=t,this._overlayed=null,this.object_id="MapsGPX.Marker#"+MapsGPX.Marker.nextval(),o.position=new google.maps.LatLng(i.lat,i.lon),google.maps.Marker.apply(this,[o])},MapsGPX.Marker._sequence=0,MapsGPX.Marker.nextval=function(){return++MapsGPX.Marker._sequence},MapsGPX.Marker.prototype=Object.create(google.maps.Marker.prototype,{constructor:{value:MapsGPX.Marker}}),MapsGPX.Marker.prototype.overlayed=function(){return this._overlayed},MapsGPX.Marker.prototype.isWpt=function(){return this._element==MapsGPX.ELEMENTS.WPT?!0:!1},MapsGPX.Marker.prototype.isRte=function(){return this._element==MapsGPX.ELEMENTS.RTE?!0:!1},MapsGPX.Marker.prototype.isTrk=function(){return this._element==MapsGPX.ELEMENTS.TRK?!0:!1},MapsGPX.Marker.prototype.getSource=function(){return this._source},MapsGPX.Marker.prototype.setMap=function(e){this._overlayed=e?!0:!1,this["super"].setMap.call(this,e)},MapsGPX.Polyline=function(e,t,n){var i,o,r,a=t,s=n||{};for(this["super"]=google.maps.Polyline.prototype,this._element=e,this._source=t,this._overlayed=null,this.object_id="MapsGPX.Polyline#"+MapsGPX.Polyline.nextval(),s.path=new google.maps.MVCArray,i=0,o=0,r=a.length;r>o;++o)s.path.insertAt(i++,new google.maps.LatLng(a[o].lat,a[o].lon));google.maps.Polyline.apply(this,[s])},MapsGPX.Polyline._sequence=0,MapsGPX.Polyline.nextval=function(){return++MapsGPX.Polyline._sequence},MapsGPX.Polyline.prototype=Object.create(google.maps.Polyline.prototype,{constructor:{value:MapsGPX.Polyline}}),MapsGPX.Polyline.prototype.overlayed=function(){return this._overlayed},MapsGPX.Polyline.prototype.isWpt=function(){return this._element==MapsGPX.ELEMENTS.WPT?!0:!1},MapsGPX.Polyline.prototype.isRte=function(){return this._element==MapsGPX.ELEMENTS.RTE?!0:!1},MapsGPX.Polyline.prototype.isTrk=function(){return this._element==MapsGPX.ELEMENTS.TRK?!0:!1},MapsGPX.Polyline.prototype.getSource=function(){return this._source},MapsGPX.Polyline.prototype.setMap=function(e){this._overlayed=e?!0:!1,this["super"].setMap.call(this,e)},MapsGPX.Polyline.prototype.computeDistanceLinear=function(e,t){var n=this.getSource();return google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(n[parseInt(e)].lat,n[parseInt(e)].lon),new google.maps.LatLng(n[parseInt(t)].lat,n[parseInt(t)].lon))},MapsGPX.Polyline.prototype.computeDistanceTrack=function(e,t){var n,i,o,r=this.getSource(),a=0;if(e=parseInt(e),t=parseInt(t),t>=e)for(n=e,i=t;i>n;++n)o=google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(r[n].lat,r[n].lon),new google.maps.LatLng(r[n+1].lat,r[n+1].lon)),a=parseFloat(a)+parseFloat(o);else for(n=e,i=t;n>i;--n)o=google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(r[n].lat,r[n].lon),new google.maps.LatLng(r[n-1].lat,r[n-1].lon)),a=parseFloat(a)-parseFloat(o);return a},MapsGPX.createLatlngbounds=function(e){return new MapsGPX.LatLngBounds(new google.maps.LatLng(e.minlat,e.minlon),new google.maps.LatLng(e.maxlat,e.maxlon))},MapsGPX.createOverlayAsWpt=function(e,t){if(e instanceof Array)throw new Error("overlay for wpt is not created from Array");return new MapsGPX.Marker(MapsGPX.ELEMENTS.WPT,e,t)},MapsGPX.createOverlayAsRte=function(e,t){return e instanceof Array?new MapsGPX.Polyline(MapsGPX.ELEMENTS.RTE,e,t):new MapsGPX.Marker(MapsGPX.ELEMENTS.RTE,e,t)},MapsGPX.createOverlayAsTrk=function(e,t){return e instanceof Array?new MapsGPX.Polyline(MapsGPX.ELEMENTS.TRK,e,t):new MapsGPX.Marker(MapsGPX.ELEMENTS.TRK,e,t)},MapsGPX.InputHandler=function(){this.initialize.apply(this,arguments)},MapsGPX.InputHandler.prototype.initialize=function(e,t){this.type=e,this.handler=t},MapsGPX.InputHandler.prototype.setType=function(e){return this.type=e,this},MapsGPX.InputHandler.prototype.getType=function(){return this.type},MapsGPX.InputHandler.prototype.setHandler=function(e){return this.handler=e,this},MapsGPX.InputHandler.prototype.getHandler=function(){return this.handler},MapsGPX.InputHandler.defaultHandler=function(e,t){return Promise.resolve(function(t){return e})},MapsGPX.InputHandler.prototype.execute=function(e,t,n){return(this.getHandler()||MapsGPX.InputHandler.defaultHandler).call(e,t,n)},MapsGPX.defaultInputHandlerApplicationGPX=function(e,t){return MapsGPX.resolveAsText(t).then(function(t){return this.addGPX(e,t),e}.bind(this))},MapsGPX.MapControl=function(){this.initialize.apply(this,arguments)},MapsGPX.MapControl.prototype={initialize:function(e,t){var n,i={map:null,initial:Object.keys(e)[0],iconWidth:"28",iconHeight:"28",className:"map_control_button",position:"RIGHT_BOTTOM"};this.icons=e,this.settings={};for(n in i)this.settings[n]=i[n];for(n in t||{})this.settings[n]=t[n];this.map=this.settings.map,this.current_key=this.settings.initial,this.$element=this._createElement(),this.map&&this.setMap(this.map)},getElement:function(){return this.$element},isCurrentIcon:function(e){return this.current_key==e},_getIconByKey:function(e){return this.icons[e]},_getCurrentIcon:function(){return this._getIconByKey(this.current_key)},_getIconElement:function(){return this.$element.getElementsByTagName("img").item(0)},_createElement:function(){var e,t,n,i;e=document.createElement("img"),e.setAttribute("src",this._getCurrentIcon()),e.setAttribute("width",this.settings.iconWidth),e.setAttribute("height",this.settings.iconHeight),t=document.createElement("div"),t.setAttribute("class",this.settings.className),t.style.background="#fff","TOP_LEFT"==this.settings.position?(t.style.marginTop="16px",t.style.marginLeft="4px"):"RIGHT_BOTTOM"==this.settings.position?(t.style.marginBottom="8px",t.style.marginRight="8px"):t.style.margin="8px",t.style.border="1px solid transparent",t.style.borderRadius="2px",t.style.outline="none",t.style.boxShadow="0 2px 6px rgba(0, 0, 0, 0.3)",n=["webkitB","mozB","oB","msB","b"];for(var o in n)t.style[n[o]+"oxSizing"]="border-box";return i=document.createElement("a"),i.setAttribute("href","javascript:void(0)"),i.style.display="block",t.appendChild(e),i.appendChild(t),i},getMap:function(){return this.map},setMap:function(e){this.map=e,this.getMap().controls[google.maps.ControlPosition[this.settings.position]].push(this.$element)},changeIcon:function(e){return this._getIconElement().src=this._getIconByKey(e),this.current_key=e,this}},MapsGPX.prototype.initialize=function(e,t,n){var i;if(this.map=null,this.map_id=e,this.map_options=t||{},this.map_element=document.getElementById(this.map_id),!this.map_element)throw new Error("Could not get element by #"+e);this.object_id="MapsGPX#"+MapsGPX.nextval(),this.map_settings={},this.map_defaults={zoom:5,keyboardShortcuts:!1,center:new google.maps.LatLng(35.6841306,139.774103),mapTypeId:google.maps.MapTypeId.ROADMAP};for(i in this.map_defaults)this.map_settings[i]=this.map_defaults[i];for(i in this.map_options)this.map_settings[i]=this.map_options[i];this.data={},this.context={},this.hook={onShowMarker:[],onShowPolyline:[],onHideMarker:[],onHidePolyline:[],onCreateLatlngbounds:[],onCreateMarker:[],onCreatePolyline:[],onAddGPX:[]},this.filters={onAppearOverlayShow:[],onAppearOverlayHide:[]},this.input_handler={},this.extentions=[],this._afterInitialize()},MapsGPX.prototype._afterInitialize=function(){this.map=new google.maps.Map(this.map_element,this.map_settings),this.registerInputHandler(new MapsGPX.InputHandler("application/gpx",MapsGPX.defaultInputHandlerApplicationGPX)),this.use("SetTitleOnCreateMarker"),this.use("SetStrokeOptionOnCreatePolyline")},MapsGPX.prototype.getMap=function(){return this.map},MapsGPX.prototype.getMapElement=function(){return this.map_element},MapsGPX.prototype.getMapSettings=function(){return this.map_settings},MapsGPX.prototype._bounds_of=function(){var e,t,n,i=[];if(i=0<arguments.length?Array.prototype.slice.call(arguments):this.getKeysOfGPX(),0<i.length){for(e=this.getGPX(i[0]).metadata.latlngbounds.clone(),t=1,n=i.length;n>t;++t)e.union(this.getGPX(i[t]).metadata.latlngbounds);return e}return null},MapsGPX.prototype.fitBounds=function(){var e=this._bounds_of.apply(this,arguments);return e&&this.getMap().fitBounds(e),this},MapsGPX.prototype.panToBounds=function(){var e=this._bounds_of.apply(this,arguments);return e&&this.getMap().panToBounds(e),this},MapsGPX.prototype._applyAppearOverlay=function(e,t,n){var i,o;i=function(e){e.setMap(this.getMap()),e.constructor===MapsGPX.Marker?this.applyHook("onShowMarker",e):e.constructor===MapsGPX.Polyline&&this.applyHook("onShowPolyline",e)},o=function(e){e.setMap(null),e.constructor===MapsGPX.Marker?this.applyHook("onShowMarker",e):e.constructor===MapsGPX.Polyline&&this.applyHook("onShowPolyline",e)},t?this.isFilterEffective("onAppearOverlayShow",e,n)?o.call(this,e):i.call(this,e):this.isFilterEffective("onAppearOverlayHide",e,n)?i.call(this,e):o.call(this,e)},MapsGPX.prototype._appearOverlay=function(e,t,n){var i,o,r,a,s,l,p,h=n.length;for(1>h&&(n=this.getKeysOfGPX(),h=n.length),i=0;h>i;++i)for(p=this.data[n[i]][t],o=0,r=p.length;r>o;++o){p[o].overlay&&this._applyAppearOverlay(p[o].overlay,e,n[i]);for(a in p[o])if(p[o][a]instanceof Array)for(s=0,l=p[o][a].length;l>s;++s)p[o][a][s].overlay&&this._applyAppearOverlay(p[o][a][s].overlay,e,n[i])}return this},MapsGPX.prototype.showOverlayWpts=function(){return this._appearOverlay.call(this,!0,MapsGPX.ELEMENTS.WPT,arguments)},MapsGPX.prototype.hideOverlayWpts=function(){return this._appearOverlay.call(this,!1,MapsGPX.ELEMENTS.WPT,arguments)},MapsGPX.prototype.showOverlayRtes=function(){return this._appearOverlay.call(this,!0,MapsGPX.ELEMENTS.RTE,arguments)},MapsGPX.prototype.hideOverlayRtes=function(){return this._appearOverlay.call(this,!1,MapsGPX.ELEMENTS.RTE,arguments)},MapsGPX.prototype.showOverlayTrks=function(){return this._appearOverlay.call(this,!0,MapsGPX.ELEMENTS.TRK,arguments)},MapsGPX.prototype.hideOverlayTrks=function(){return this._appearOverlay.call(this,!1,MapsGPX.ELEMENTS.TRK,arguments)},MapsGPX.prototype.showOverlayGpxs=function(){this.showOverlayWpts.apply(this,arguments),this.showOverlayRtes.apply(this,arguments),this.showOverlayTrks.apply(this,arguments)},MapsGPX.prototype.hideOverlayGpxs=function(){this.hideOverlayWpts.apply(this,arguments),this.hideOverlayRtes.apply(this,arguments),this.hideOverlayTrks.apply(this,arguments)},MapsGPX._guessType=function(e){if("string"==typeof e){if(new RegExp(".jpe?g$","i").test(e))return"image/jpeg"}else if(e instanceof Blob&&"image/jpeg"==e.type)return"image/jpeg";return"application/gpx"},MapsGPX.prototype.registerInputHandler=function(e){if(!(e instanceof MapsGPX.InputHandler))throw new Error("invalid argument, it requires instance of MapsGPX.InputHandler");return this.input_handler[e.type]=e,this},MapsGPX.prototype._getInputHandlerByType=function(e){var t=this.input_handler[e];return t?t:null},MapsGPX.prototype.input=function(e,t,n){var i;return n=n||MapsGPX._guessType(t),i=this._getInputHandlerByType(n),i?i.execute(this,e,t):(console.log("There is no handler for type=["+n+"]"),(new MapsGPX.InputHandler).execute(this,e,t))},MapsGPX.prototype.getGPX=function(e){return this.data[e]},MapsGPX.prototype.eachGPX=function(e){var t;for(t in this.data)e(this.data[t],t);return this},MapsGPX.prototype.getKeysOfGPX=function(){return Object.keys(this.data)},MapsGPX.prototype.addGPX=function(e,t){this.removeGPX(e);try{this.data[e]=this._build(t),this.applyHook("onAddGPX",e)}catch(n){throw new Error("Catch an exception at addGPX with "+e+", reason: "+n)}return this},MapsGPX.prototype.removeGPX=function(e){return this.data[e]&&(this.hideOverlayWpts(e),this.hideOverlayRtes(e),this.hideOverlayTrks(e)),this.data[e]=null,delete this.data[e],this},MapsGPX.prototype._build=function(e){var t,n,i,o,r,a=MapsGPX.GPXToJSON(MapsGPX.parseXML(e));for(a.metadata.latlngbounds=MapsGPX.createLatlngbounds(a.metadata.bounds),this.applyHook("onCreateLatlngbounds",a.metadata.latlngbounds),t=0,i=a.wpt.length;i>t;++t)a.wpt[t].overlay=MapsGPX.createOverlayAsWpt(a.wpt[t]),this.applyHook("onCreateMarker",a.wpt[t].overlay);for(t=0,i=a.rte.length;i>t;++t)for(a.rte[t].overlay=MapsGPX.createOverlayAsRte(a.rte[t].rtept),this.applyHook("onCreatePolyline",a.rte[t].overlay),n=0,o=a.rte[t].rtept.length;o>n;++n)a.rte[t].rtept[n].overlay=MapsGPX.createOverlayAsRte(a.rte[t].rtept[n]),this.applyHook("onCreateMarker",a.rte[t].rtept[n].overlay);if(MapsGPX.join_trkseg)for(t=0,i=a.trk.length;i>t;++t){for(r=[],n=0,o=a.trk[t].trkseg.length;o>n;++n)r=r.concat(a.trk[t].trkseg[n].trkpt);a.trk[t].overlay=MapsGPX.createOverlayAsTrk(r),this.applyHook("onCreatePolyline",a.trk[t].overlay)}else for(t=0,i=a.trk.length;i>t;++t)for(n=0,o=a.trk[t].trkseg.length;o>n;++n)a.trk[t].trkseg[n].overlay=MapsGPX.createOverlayAsTrk(a.trk[t].trkseg[n].trkpt),this.applyHook("onCreatePolyline",a.trk[t].trkseg[n].overlay);return a},MapsGPX.prototype.use=function(e,t){MapsGPX.plugin[e].path||(MapsGPX.plugin[e].path=[MapsGPX.plugin_dir,e].join("/"));try{MapsGPX.plugin[e].callback.bind(this)(t)}catch(n){console.error('Catch an exception on use "'+e+'": '+n),console.trace()}return this},MapsGPX.prototype.extend=function(e,t){return this.extentions.push({plugin_name:e,params:t||{}}),this},MapsGPX.prototype.extended=function(e){var t,n,i=[];for(t=0,n=this.extentions.length;n>t;++t)i.push(this.extentions[t].plugin_name);return MapsGPX.require_plugins.apply(this,i).then(function(){var e,t;for(e=0,t=this.extentions.length;t>e;++e)this.use(this.extentions[e].plugin_name,this.extentions[e].params);this.extentions=[]}.bind(this)).then(e.bind(this)),this},MapsGPX.prototype.register=function(e,t){try{this._registerHook(e,t)}catch(n){throw console.log("Catch an exception on register("+e+")"),console.trace(),n}return this},MapsGPX.prototype._registerHook=function(e,t){e?this.hook[e].push(t.bind(this)):t.bind(this)()},MapsGPX.prototype.applyHook=function(){var e,t,n=arguments[0],i=Array.prototype.slice.call(arguments,1);for(e=0,t=this.hook[n].length;t>e;++e)try{this.hook[n][e].apply(this,i)}catch(o){throw console.log('Catch an exception on applyHook "'+n+'" with args ['+i+"]"),console.trace(),o}return this},MapsGPX.prototype.addFilter=function(e,t,n){return this.filters[t][e]=n,this},MapsGPX.prototype.removeFilter=function(e,t){return delete this.filters[t][e],this},MapsGPX.prototype.isFilterEffective=function(){var e,t,n=null,i=Array.prototype.slice.call(arguments),o=i.shift();for(e in this.filters[o]){t=!1;try{t="function"==typeof this.filters[o][e]?this.filters[o][e].apply(this,i):this.filters[o][e]?!0:!1}catch(r){console.log('Catch an exception on isFilterEffective("'+o+'") on "'+e+'": '+r)}if(t){n=!0;break}}return n},MapsGPX.plugin={},MapsGPX.plugin.SetTitleOnCreateMarker={callback:function(e){this.register("onCreateMarker",function(e){e.setTitle(e.getSource().name)}.bind(this))}},MapsGPX.plugin.SetStrokeOptionOnCreatePolyline={callback:function(e){this.register("onCreatePolyline",function(e){e.isRte()?e.setOptions({strokeColor:"#00FF66",strokeOpacity:.75,strokeWeight:2}):e.isTrk()&&e.setOptions({strokeColor:"#0066FF",strokeOpacity:.5,strokeWeight:4})}.bind(this))}},MapsGPX.load_script=function(e){return new Promise(function(t,n){var i=document.createElement("script");i.onload=function(){t()},i.src=e,document.head.appendChild(i)})},MapsGPX.load_css=function(e){return new Promise(function(t,n){var i=document.createElement("link");i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",e),i.onload=function(){t()},document.head.appendChild(i)})},MapsGPX.require_plugin=function(e){var t,n=(new Date).getTime(),i=[MapsGPX.plugin_dir,e].join("/"),o={plugin_name:e,base:i,t:n};return t=MapsGPX.cache_script?[i,MapsGPX.scrip_loader].join("/"):[i,MapsGPX.scrip_loader+"?t="+n].join("/"),MapsGPX.load_script(t).then(function(){var e,t,n,i,o=[];for(MapsGPX.plugin[this.plugin_name].path=this.base,e=MapsGPX.plugin[this.plugin_name].bundles||[],n=0,i=e.length;i>n;++n)t=e[n].match(/\//)?e[n]:MapsGPX.cache_script?[this.base,e[n]].join("/"):[this.base,e[n]+"?t="+this.t].join("/"),e[n].match(/\.css$/)?o.push(MapsGPX.load_css(t)):o.push(MapsGPX.load_script(t));return Promise.all(o)}.bind(o))},MapsGPX.require_plugins=function(){var e,t,n=Array.prototype.map.call(arguments,function(e){return e}),i=Promise.resolve(null);for(e=0,t=n.length;t>e;++e)i=i.then(function(){return MapsGPX.require_plugin(this.plugin_name)}.bind({plugin_name:n[e]}));return i},MapsGPX._ready=!1,MapsGPX._on_readies=[],MapsGPX.onReady=function(e){MapsGPX._on_readies.push(e),MapsGPX._ready&&MapsGPX._emit()},MapsGPX._emit=function(){for(var e;;){if(e=MapsGPX._on_readies.shift(),!e)break;e.call(this)}return this},function(){google.maps.event.addDomListener(window,"load",function(){MapsGPX._ready=!0,MapsGPX._emit()})}(),MapsGPX.plugin.DescImage={callback:function(e){this.register("onCreateMarker",function(e){var t=e.getSource().desc;(!new RegExp("[\r\n]").test(t)&&new RegExp(".jpe?g$","i").test(t)||new RegExp("^data:image/jpeg;base64,[+/=0-9A-Za-z\r\n]+$").test(t)||new RegExp("^blob:(https?(:|%3A)//[-_.(:|%3A)0-9A-Za-z]+?|file(:|%3A)//)/[-0-9A-Za-z]+$").test(t)||new RegExp("^blob:null/[-0-9A-Za-z]+$").test(t))&&(google.maps.event.addListener(e,"click",function(e){this._infowindow||(this._infowindow=new google.maps.InfoWindow({
content:['<div><img class="info-window" src="',t,'"/></div>'].join("")})),this._infowindow.open(this.getMap(),this)}),e.setIcon(new google.maps.MarkerImage([MapsGPX.plugin.DescImage.path,"photo.png"].join("/"),new google.maps.Size(32,37))))}.bind(this))}},MapsGPX.plugin.DrawerCSS={bundles:["drawer-css.js"],callback:function(e){}},DrawerCSS.VERSION="0.4.0",DrawerCSS._vendorT=["webkitT","mozT","oT","msT","t"],DrawerCSS.getDimensions=function(e){var t=e.style.display;if("none"!=t&&null!=t)return{width:e.offsetWidth,height:e.offsetHeight};var n=e.style,i=n.visibility,o=n.position,r=n.display,a=e.clientWidth;e.clientHeight;return n.visibility="hidden",n.position="absolute",n.display="block",n.display=r,n.position=o,n.visibility=i,{width:a,height:e.originalHeight}},DrawerCSS.defaults={duration:.3,delay:0,timingFunction:"ease-in-out",effect:"slide",side:"LEFT",span:"80%",maxSpan:null},DrawerCSS.prototype={initialize:function(e,t,n){var i;n=n||{},this.settings={};for(i in DrawerCSS.defaults)this.settings[i]=DrawerCSS.defaults[i];for(i in n)this.settings[i]=n[i];this.duration=parseFloat(this.settings.duration).toString(),this.delay=parseFloat(this.settings.delay).toString(),this.timingFunction=this.settings.timingFunction.toLowerCase(),this.effect=this.settings.effect.toLowerCase(),this.side=this.settings.side.toUpperCase(),this.span=this.settings.span,this.maxSpan=this.settings.maxSpan,this.span.toString().match(/\d+$/)&&(this.span=this.span+"px"),this.maxSpan&&this.maxSpan.toString().match(/\d+$/)&&(this.maxSpan=this.maxSpan+"px"),this._opened=!1,this._events={},this._origin={},this.$main=document.getElementById(e),this.$sub=document.getElementById(t),this.$sub||(this.$sub=document.createElement("div"),this.$sub.setAttribute("id",t)),this.reset()},active_span:function(){var e=this.span;return"function"==typeof this.span&&(e=this.span.call(this)),this.maxSpan&&(e.toString().match(/%$/)?e=this._span_limited_by_percent():e.toString().match(/\d+\s*px$/)&&(e=this._span_limited_by_pixel())),e},_span_limited_by_percent:function(){var e,t={LEFT:"width",TOP:"height",RIGHT:"width",BOTTOM:"height"}[this.side],n=DrawerCSS.getDimensions(this.getElementBase())[t];return this.maxSpan.toString().match(/px$/)?(e=parseInt(n*parseInt(this.span)/100),parseInt(this.maxSpan)<e&&(e=parseInt(this.maxSpan)),e+="px",this.getElementDrawer().style[t]=e,e):(console.error('the option "maxSpan" has to be specified as "px"'),this.span)},_span_limited_by_pixel:function(){var e,t,n={LEFT:"width",TOP:"height",RIGHT:"width",BOTTOM:"height"}[this.side],i=DrawerCSS.getDimensions(this.getElementBase())[n];return this.maxSpan.toString().match(/%$/)?(e=parseInt(this.span),t=parseInt(i*parseInt(this.maxSpan)/100),e>t&&(e=t),e+="px",this.getElementDrawer().style[n]=e,e):(console.error('the option "maxSpan" has to be specified as "%"'),this.span)},reset:function(){this.destroy(),this.$main.parentNode.style.position="relative",this.$main.style.width="100%",this.$main.style.height="100%",this[{slide:"_init_slide",compress:"_init_compress"}[this.effect]].call(this),this.$main.style.position="absolute",this.$sub.style.position="absolute",this.$main.parentNode.insertBefore(this.$sub,this.$main)},destroy:function(){var e;for(e in DrawerCSS._vendorT)this.$main.style[DrawerCSS._vendorT[e]+"ransitionProperty"]="",this.$main.style[DrawerCSS._vendorT[e]+"ransitionDuration"]="",this.$main.style[DrawerCSS._vendorT[e]+"ransitionDelay"]="",this.$main.style[DrawerCSS._vendorT[e]+"ransitionTimingFunction"]="";this.$main.parentNode.style.position="",this.$main.style.position="",this.$main.style.width="",this.$main.style.height="",this.$main.style.top="",this.$main.style.right="",this.$main.style.bottom="",this.$main.style.left="",this.$sub.style.position="",this.$sub.style.width="",this.$sub.style.height="",this.$sub.style.top="",this.$sub.style.right="",this.$sub.style.bottom="",this.$sub.style.left=""},_init_slide:function(){var e;for(e in DrawerCSS._vendorT)this.$main.style[DrawerCSS._vendorT[e]+"ransitionProperty"]="top,right,bottom,left",this.$main.style[DrawerCSS._vendorT[e]+"ransitionDuration"]=this.duration+"s",this.$main.style[DrawerCSS._vendorT[e]+"ransitionDelay"]=this.delay+"s",this.$main.style[DrawerCSS._vendorT[e]+"ransitionTimingFunction"]=this.timingFunction;if("TOP"==this.side)this.$main.style.bottom||(this.$main.style.bottom=0),this._origin={attribute:"bottom",value:this.$main.style.bottom},this.$sub.style.width="100%",this.$sub.style.height=this.active_span(),this.$sub.style.top=0,this.$sub.style.right="",this.$sub.style.bottom="",this.$sub.style.left=0;else if("RIGHT"==this.side)this.$main.style.left||(this.$main.style.left=0),this._origin={attribute:"left",value:this.$main.style.left},this.$sub.style.width=this.active_span(),this.$sub.style.height="100%",this.$sub.style.top=0,this.$sub.style.right=0,this.$sub.style.bottom="",this.$sub.style.left="";else if("BOTTOM"==this.side)this.$main.style.top||(this.$main.style.top=0),this._origin={attribute:"top",value:this.$main.style.top},this.$sub.style.width="100%",this.$sub.style.height=this.active_span(),this.$sub.style.top="",this.$sub.style.right=0,this.$sub.style.bottom=0,this.$sub.style.left="";else{if("LEFT"!=this.side)throw new Error("The property 'side' is invalid value");this.$main.style.right||(this.$main.style.right=0),this._origin={attribute:"right",value:this.$main.style.right},this.$sub.style.width=this.active_span(),this.$sub.style.height="100%",this.$sub.style.top=0,this.$sub.style.right="",this.$sub.style.bottom="",this.$sub.style.left=0}},_init_compress:function(){var e;for(e in DrawerCSS._vendorT)this.$main.style[DrawerCSS._vendorT[e]+"ransitionProperty"]="width,height",this.$main.style[DrawerCSS._vendorT[e]+"ransitionDuration"]=this.duration+"s",this.$main.style[DrawerCSS._vendorT[e]+"ransitionDelay"]=this.delay+"s",this.$main.style[DrawerCSS._vendorT[e]+"ransitionTimingFunction"]=this.timingFunction;if("TOP"==this.side)this.$main.style.bottom=0,this.$sub.style.width="100%",this.$sub.style.height=this.active_span(),this.$sub.style.top=0,this.$sub.style.left=0;else if("RIGHT"==this.side)this.$main.style.left=0,this.$sub.style.width=this.active_span(),this.$sub.style.height="100%",this.$sub.style.bottom=0,this.$sub.style.right=0;else if("BOTTOM"==this.side)this.$main.style.top=0,this.$sub.style.width="100%",this.$sub.style.height=this.active_span(),this.$sub.style.bottom=0,this.$sub.style.right=0;else{if("LEFT"!=this.side)throw new Error("A property 'side' is invalid value");this.$main.style.right=0,this.$sub.style.width=this.active_span(),this.$sub.style.height="100%",this.$sub.style.top=0,this.$sub.style.left=0}},getElementBase:function(){return this.$main},getElementDrawer:function(){return this.$sub},isOpened:function(){return this._opened},open:function(){if(this._opened=!0,this[{slide:"_open_slide",compress:"_open_compress"}[this.effect]].call(this),this._events.open)try{for(var e=0,t=this._events.open.length;t>e;++e)this._events.open[e].call(this)}catch(n){console.error(n)}return this},_open_slide:function(){this.$main.style[{LEFT:"right",TOP:"bottom",RIGHT:"left",BOTTOM:"top"}[this.side]]="-"+this.active_span()},_open_compress:function(){"LEFT"==this.side?(this.$sub.style.width=this.active_span(),this.$main.style.width=DrawerCSS.getDimensions(this.$main).width-DrawerCSS.getDimensions(this.$sub).width+"px"):"BOTTOM"==this.side?(this.$sub.style.height=this.active_span(),this.$main.style.height=DrawerCSS.getDimensions(this.$main).height-DrawerCSS.getDimensions(this.$sub).height+"px"):"TOP"==this.side?(this.$sub.style.height=this.active_span(),this.$main.style.height=DrawerCSS.getDimensions(this.$main).height-DrawerCSS.getDimensions(this.$sub).height+"px"):"RIGHT"==this.side&&(this.$sub.style.width=this.active_span(),this.$main.style.width=DrawerCSS.getDimensions(this.$main).width-DrawerCSS.getDimensions(this.$sub).width+"px")},close:function(){if(this._opened=!1,this[{slide:"_close_slide",compress:"_close_compress"}[this.effect]].call(this),this._events.close)try{for(var e=0,t=this._events.close.length;t>e;++e)this._events.close[e].call(this)}catch(n){console.error(n)}return this},_close_slide:function(){this.$main.style[this._origin.attribute]=this._origin.value},_close_compress:function(){this.$main.style[{TOP:"height",RIGHT:"width",BOTTOM:"height",LEFT:"width"}[this.side]]=""},toggle:function(){return this.isOpened()?(this.close(),!1):(this.open(),!0)},addHandler:function(e,t){return this._events[e]||(this._events[e]=[]),this._events[e].push(t),this}},MapsGPX.plugin.Droppable={callback:function(e){var t=document.getElementById(this.map_id);google.maps.event.addDomListener(t,"dragover",function(e){e.stopPropagation(),e.preventDefault()}.bind(this)),google.maps.event.addDomListener(t,"drop",function(e){var t,n,i,o;for(e.stopPropagation(),e.preventDefault(),t=e.dataTransfer.files,i=0,o=t.length;o>i;++i)n=t[i],console.log("Dropped: name=["+n.name+"] type=["+n.type+"] size=["+n.size+"]"),this.input(n.name,n)}.bind(this))}},MapsGPX.plugin.EXIF={bundles:["exif.js"],readFromArrayBuffer:function(e){return EXIF.readFromBinaryFile(e)},createLatlngFromExif:function(e){if(e.GPSLatitude&&e.GPSLongitude){var t=e.GPSLatitude,n=t[0].numerator/t[0].denominator,i=t[1].numerator/t[1].denominator,o=t[2].numerator/t[2].denominator,r=e.GPSLongitude,a=r[0].numerator/r[0].denominator,s=r[1].numerator/r[1].denominator,l=r[2].numerator/r[2].denominator;return new google.maps.LatLng(n+i/60+o/3600,a+s/60+l/3600)}return null},callback:function(e){var t;this.hook.onReadEXIF=this.hook.onReadEXIF||[],console.log("Extends MapsGPX.Polyline.prototype.findNearestVertexByDate"),MapsGPX.Polyline.prototype.findNearestVertexByDate=function(e){var t,n,i=this.getSource(),o=null,r=!1,a=-1;for(t=0,n=i.length;n>t;++t)if(o=new Date(i[t].time),o>=e){e==o&&(r=!0),a=t;break}return a>=1||0==a&&r?{latlng:this.getPath().getAt(a),time:o,index:a}:null},t=function(e,t){var n=MapsGPX.resolveAsArrayBuffer(t),i=MapsGPX.resolveAsObjectURL(t);return Promise.all([n,i,t]).then(function(t){var n,i,o,r,a,s,l,p,h=MapsGPX.plugin.EXIF.readFromArrayBuffer(t[0]),c=MapsGPX.plugin.EXIF.createLatlngFromExif(h),u=[],g=[];if(null==c&&h.DateTimeOriginal&&(n=h.DateTimeOriginal.split(/\s+/),i=new Date(n[0].replace(/:/g,"/")+" "+n[1]),a=function(e,t){var n;return e?(n=e.findNearestVertexByDate(i),n&&(n.key=t,this.push(n)),!0):!1},this.eachGPX(function(e,t){var n,i,o,r;for(n=0,i=e.trk.length;i>n;++n)if(!a.call(this,e.trk[n].overlay,t))for(o=0,r=e.trk[n].trkseg.length;r>o;++o)a.call(this,e.trk[n].trkseg[o].overlay,t)}.bind(u)),0<u.length)){for(s=u.sort(function(e,t){return e.time-t.time}),u=[],u.push(s[0]),l=s[0].time,o=1,r=s.length;r>o&&l.toJSON()==s[o].time.toJSON();++o)u.push(s[o]);c=u[0].latlng,g=u}if(p={exif:h,url:t[1],src:t[2],gpx:null,latlng:c,alternatives:g},!c)throw new Error('Could not detect coordinate of the image "'+e+'"');return 0!=this.hook.onReadEXIF.length?this.applyHook("onReadEXIF",e,p):MapsGPX.plugin.EXIF._handlerHookOnReadExifDefault.call(this,e,p),e}.bind(this))},console.log('Register an input handler for "image/jpeg"'),this.registerInputHandler(new MapsGPX.InputHandler("image/jpeg",t))},_handlerHookOnReadExifDefault:function(e,t){var n,i,o,r=null;if(t.alternatives.length<=1)r=t.latlng;else for(n=0,i=t.alternatives.length;i>n;++n)if(window.confirm('Are you sure the image is on "'+t.alternatives[n].key+'" ?')){r=t.alternatives[n].latlng;break}r?(o=[t.exif.DateTimeOriginal," - ",e,'<br/><img class="info-window" src="',t.url,'"/>'].join(""),this.map.panTo(t.latlng),new google.maps.InfoWindow({content:o,position:r}).open(this.map)):window.alert('Could not detect coordinate of the image "'+e+'"')}},function(){function e(e){return!!e.exifdata}function t(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(e),i=n.length,o=new ArrayBuffer(i),r=new Uint8Array(o),a=0;i>a;a++)r[a]=n.charCodeAt(a);return o}function i(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){(200==this.status||0===this.status)&&t(this.response)},n.send()}function o(e,n){function o(t){var i=r(t),o=a(t);e.exifdata=i||{},e.iptcdata=o||{},n&&n.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var s=t(e.src);o(s)}else if(/^blob\:/i.test(e.src)){var l=new FileReader;l.onload=function(e){o(e.target.result)},i(e.src,function(e){l.readAsArrayBuffer(e)})}else{var p=new XMLHttpRequest;p.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";o(p.response),p=null},p.open("GET",e.src,!0),p.responseType="arraybuffer",p.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var l=new FileReader;l.onload=function(e){u&&console.log("Got file of length "+e.target.result.byteLength),o(e.target.result)},l.readAsArrayBuffer(e)}}function r(e){var t=new DataView(e);if(u&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return u&&console.log("Not a valid JPEG"),!1;for(var n,i=2,o=e.byteLength;o>i;){if(255!=t.getUint8(i))return u&&console.log("Not a valid marker at offset "+i+", found: "+t.getUint8(i)),!1;if(n=t.getUint8(i+1),u&&console.log(n),225==n)return u&&console.log("Found 0xFFE1 marker"),c(t,i+4,t.getUint16(i+2)-2);i+=2+t.getUint16(i+2)}}function a(e){var t=new DataView(e);if(u&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return u&&console.log("Not a valid JPEG"),!1;for(var n=2,i=e.byteLength,o=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};i>n;){if(o(t,n)){var r=t.getUint8(n+7);r%2!==0&&(r+=1),0===r&&(r=4);var a=n+8+r,l=t.getUint16(n+6+r);return s(e,a,l)}n++}}function s(e,t,n){for(var i,o,r,a,s,l=new DataView(e),p={},c=t;t+n>c;)28===l.getUint8(c)&&2===l.getUint8(c+1)&&(a=l.getUint8(c+2),a in P&&(r=l.getInt16(c+3),s=r+5,o=P[a],i=h(l,c+5,r),p.hasOwnProperty(o)?p[o]instanceof Array?p[o].push(i):p[o]=[p[o],i]:p[o]=i)),c++;return p}function l(e,t,n,i,o){var r,a,s,l=e.getUint16(n,!o),h={};for(s=0;l>s;s++)r=n+12*s+2,a=i[e.getUint16(r,!o)],!a&&u&&console.log("Unknown tag: "+e.getUint16(r,!o)),h[a]=p(e,r,t,n,o);return h}function p(e,t,n,i,o){var r,a,s,l,p,c,u=e.getUint16(t+2,!o),g=e.getUint32(t+4,!o),d=e.getUint32(t+8,!o)+n;switch(u){case 1:case 7:if(1==g)return e.getUint8(t+8,!o);for(r=g>4?d:t+8,a=[],l=0;g>l;l++)a[l]=e.getUint8(r+l);return a;case 2:return r=g>4?d:t+8,h(e,r,g-1);case 3:if(1==g)return e.getUint16(t+8,!o);for(r=g>2?d:t+8,a=[],l=0;g>l;l++)a[l]=e.getUint16(r+2*l,!o);return a;case 4:if(1==g)return e.getUint32(t+8,!o);for(a=[],l=0;g>l;l++)a[l]=e.getUint32(d+4*l,!o);return a;case 5:if(1==g)return p=e.getUint32(d,!o),c=e.getUint32(d+4,!o),s=new Number(p/c),s.numerator=p,s.denominator=c,s;for(a=[],l=0;g>l;l++)p=e.getUint32(d+8*l,!o),c=e.getUint32(d+4+8*l,!o),a[l]=new Number(p/c),a[l].numerator=p,a[l].denominator=c;return a;case 9:if(1==g)return e.getInt32(t+8,!o);for(a=[],l=0;g>l;l++)a[l]=e.getInt32(d+4*l,!o);return a;case 10:if(1==g)return e.getInt32(d,!o)/e.getInt32(d+4,!o);for(a=[],l=0;g>l;l++)a[l]=e.getInt32(d+8*l,!o)/e.getInt32(d+4+8*l,!o);return a}}function h(e,t,i){var o="";for(n=t;n<t+i;n++)o+=String.fromCharCode(e.getUint8(n));return o}function c(e,t){if("Exif"!=h(e,t,4))return u&&console.log("Not valid EXIF data! "+h(e,t,4)),!1;var n,i,o,r,a,s=t+6;if(18761==e.getUint16(s))n=!1;else{if(19789!=e.getUint16(s))return u&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=e.getUint16(s+2,!n))return u&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var p=e.getUint32(s+4,!n);if(8>p)return u&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(s+4,!n)),!1;if(i=l(e,s,s+p,m,n),i.ExifIFDPointer){r=l(e,s,s+i.ExifIFDPointer,f,n);for(o in r){switch(o){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":r[o]=v[o][r[o]];break;case"ExifVersion":case"FlashpixVersion":r[o]=String.fromCharCode(r[o][0],r[o][1],r[o][2],r[o][3]);break;case"ComponentsConfiguration":r[o]=v.Components[r[o][0]]+v.Components[r[o][1]]+v.Components[r[o][2]]+v.Components[r[o][3]]}i[o]=r[o]}}if(i.GPSInfoIFDPointer){a=l(e,s,s+i.GPSInfoIFDPointer,y,n);for(o in a){switch(o){case"GPSVersionID":a[o]=a[o][0]+"."+a[o][1]+"."+a[o][2]+"."+a[o][3]}i[o]=a[o]}}return i}var u=!1,g=this,d=function(e){return e instanceof d?e:this instanceof d?void(this.EXIFwrapped=e):new d(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=d),exports.EXIF=d):g.EXIF=d;var f=d.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},m=d.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},y=d.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},v=d.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},P={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};d.getData=function(t,n){return(t instanceof Image||t instanceof HTMLImageElement)&&!t.complete?!1:(e(t)?n&&n.call(t):o(t,n),!0)},d.getTag=function(t,n){return e(t)?t.exifdata[n]:void 0},d.getAllTags=function(t){if(!e(t))return{};var n,i=t.exifdata,o={};for(n in i)i.hasOwnProperty(n)&&(o[n]=i[n]);return o},d.pretty=function(t){if(!e(t))return"";var n,i=t.exifdata,o="";for(n in i)i.hasOwnProperty(n)&&(o+="object"==typeof i[n]?i[n]instanceof Number?n+" : "+i[n]+" ["+i[n].numerator+"/"+i[n].denominator+"]\r\n":n+" : ["+i[n].length+" values]\r\n":n+" : "+i[n]+"\r\n");return o},d.readFromBinaryFile=function(e){return r(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return d})}.call(this),MapsGPX.plugin.EXIF2GPX={callback:function(e){this.context.EXIF2GPX={pts:[]},this.register("onReadEXIF",function(e,t){var n,i,o,r,a,s;if(this.context.EXIF2GPX.pts.push({lat:t.latlng.lat(),lon:t.latlng.lng()}),1<this.context.EXIF2GPX.pts.length?(n=MapsGPX.boundsOf(this.context.EXIF2GPX.pts),this.map.fitBounds(MapsGPX.createLatlngbounds(n))):this.map.panTo(t.latlng),i=null,t.alternatives.length<=1)i=t.latlng;else for(o=0,r=t.alternatives.length;r>o;++o)if(window.confirm('Are you sure the image is on "'+t.alternatives[o].key+'" ?')){i=t.alternatives[o].latlng;break}i?(a=t.exif.DateTimeOriginal||"(unknown)",s=['<?xml version="1.0"?>','<gpx version="1.1" creator="maps.gpx" ','xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.topografix.com/GPX/1/1" ','xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">',"<metadata>",a?"<name><![CDATA["+a+"]]></name>":"","</metadata>",'<wpt lat="'+t.latlng.lat()+'" lon="'+t.latlng.lng()+'">',a?"<name><![CDATA["+a+"]]></name>":"","<desc><![CDATA["+t.url+"]]></desc>","</wpt></gpx>"].join(""),this.addGPX(e,s)):window.alert('Could not detect coordinate of the image "'+e+'"')}.bind(this))}},MapsGPX.plugin.EXIFMarker={callback:function(e){this.context.EXIFMarker={pts:[]},this.register("onReadEXIF",function(e,t){var n,i,o,r,a,s;if(this.context.EXIFMarker.pts.push({lat:t.latlng.lat(),lon:t.latlng.lng()}),1<this.context.EXIFMarker.pts.length?(n=MapsGPX.boundsOf(this.context.EXIFMarker.pts),this.map.fitBounds(MapsGPX.createLatlngbounds(n))):this.map.panTo(t.latlng),i=null,t.alternatives.length<=1)i=t.latlng;else for(o=0,r=t.alternatives.length;r>o;++o)if(window.confirm('Are you sure the image is on "'+t.alternatives[o].key+'" ?')){i=t.alternatives[o].latlng;break}i?(a=["<div><strong>",t.exif.DateTimeOriginal," - ",e,"</strong></div><hr/>",'<div><img class="info-window" src="',t.url,'"/></div>'].join(""),s=new google.maps.Marker({position:t.latlng,draggable:!0,icon:new google.maps.MarkerImage([MapsGPX.plugin.EXIFMarker.path,"photo.png"].join("/"),new google.maps.Size(32,37))}),s.addListener("click",function(e){new google.maps.InfoWindow({content:a}).open(this.map,this)}),s.setMap(this.map)):window.alert('Could not detect coordinate of the image "'+e+'"')}.bind(this))}},MapsGPX.plugin.Editor={callback:function(e){this.register("onCreatePolyline",function(e){e.addListener("click",function(e){this.polyline.setEditable(!0)}.bind({app:this,polyline:e})),e.addListener("dblclick",function(e){this.polyline.setEditable(!1)}.bind({app:this,polyline:e}))}.bind(this))}},MapsGPX.plugin.ElevationChart={bundles:["https://www.google.com/jsapi"],templateOfId:"chart_canvas",_sequence:0,generateId:function(){return this.templateOfId+""+ ++this._sequence},callback:function(e){var t=new MapsGPX.MapControl({initial:[MapsGPX.plugin.ElevationChart.path,"ic_trending_up_black_48dp.png"].join("/")},{map:this.getMap()});google.load("visualization","1",{packages:["corechart"],callback:function(){var e,t=this.app,n=this.control,i={effect:"compress",side:"BOTTOM",span:"30%"},o=new DrawerCSS(t.getMapElement().getAttribute("id"),MapsGPX.plugin.ElevationChart.generateId(),i);o.chart=new google.visualization.LineChart(o.getElementDrawer()),o.marker=new google.maps.Marker({icon:new google.maps.MarkerImage([MapsGPX.plugin.ElevationChart.path,"you-are-here-2.png"].join("/"),new google.maps.Size(32,37))}),o.current_polyline=null,google.maps.event.addDomListener(n.getElement(),"click",function(e){this.toggle()}.bind(o)),google.maps.event.addDomListener(window,"resize",function(e){this.close()}.bind(o)),google.visualization.events.addListener(o.chart,"select",function(){var e,t;this.on_select_chart&&(e=this.chart.getSelection(),e&&(t=e[0],t&&this.on_select_chart.call(this,t.row,t.column)))}.bind(o)),t.register("onVertexInfo",function(e,t,n){this.isOpened()&&this.current_polyline===e&&this.chart.setSelection([{row:t,column:1}])}.bind(o)),e=function(e){var t,n,i,o,r,a=[],s=0;if(this.view.isOpened()){if(this.view.current_polyline!==this.polyline){for(t=this.polyline.getSource(),a=[],s=0,a.push(["distance","ele"]),a.push([0,parseInt(t[0].ele)]),n=1,i=t.length;i>n;++n)s+=parseInt(google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(t[n-1].lat,t[n-1].lon),new google.maps.LatLng(t[n].lat,t[n].lon))),a.push([s,parseInt(t[n].ele)]);o=google.visualization.arrayToDataTable(a),r={title:t.name||"Elevation chart of the trk",legend:{position:"none"},vAxis:{format:"decimal"},hAxis:{format:"decimal"}},this.view.marker.setMap(null),this.view.chart.draw(o,r),this.view.current_polyline=this.polyline,this.view.on_select_chart=function(e,t){var n=o.getValue(e,t);this.view.marker.setPosition(this.polyline.getPath().getAt(e)),this.view.marker.setTitle("#"+e+" - ele = "+n+"m"),this.view.marker.getMap()||this.view.marker.setMap(this.polyline.getMap())}.bind(this),this.view.addHandler("close",function(){this.current_polyline=null,this.marker.setMap(null),this.chart.clearChart()}.bind(this.view))}}else this.view.current_polyline=null,this.view.marker.setMap(null),this.view.chart.clearChart()},t.register("onCreatePolyline",function(t){google.maps.event.addListener(t,"click",e.bind({view:this,polyline:t}))}.bind(o)),t.eachGPX(function(t,n){var i,o,r,a,s,l=t.trk.length;for(i=0;l>i;++i)if(o=t.trk[i],o.overlay)google.maps.event.addListener(o.overlay,"click",e.bind({view:this,polyline:o.overlay}));else for(r=0,a=o.trkseg.length;a>r;++r)s=o[r],s.overlay&&google.maps.event.addListener(s.overlay,"click",e.bind({view:this,polyline:s.overlay}))}.bind(o))}.bind({app:this,control:t})})}},MapsGPX.plugin.FileClip={callback:function(e){var t;return this.context.SidePanelControl?(this.context.FileClip?t=this.context.FileClip.getElementsByTagName("ul").item(0):(this.context.FileClip=document.createElement("div"),this.context.SidePanelControl.getElementDrawer().appendChild(this.context.FileClip),t=document.createElement("ul"),this.context.FileClip.appendChild(t)),this.addFilter("FileClip","onAppearOverlayShow",function(e,t){var n,i,o=this.context.FileClip.getElementsByTagName("input");for(n=0,i=o.length;i>n;++n)if(o.item(n).value==t)return o.item(n).checked?!1:!0;return!1}.bind(this)),void this.register("onAddGPX",function(e){var t,n,i,o;t=document.createElement("input"),t.setAttribute("type","checkbox"),t.setAttribute("value",e),t.checked=!0,google.maps.event.addDomListener(t,"change",function(e){e.target.checked?this.showOverlayGpxs(e.target.value):this.hideOverlayGpxs(e.target.value)}.bind(this)),o=e,new RegExp("([^/]+)$").test(o)&&(o=RegExp.$1),n=document.createElement("label"),n.appendChild(t),n.appendChild(document.createTextNode(o)),i=document.createElement("li"),i.appendChild(n),this.context.FileClip.getElementsByTagName("ul").item(0).appendChild(i)})):void console.log('The plugin "FileClip" requires "SidePanelControl"')}},MapsGPX.plugin.GeoLocation={watcher:null,options:{enableHighAccuracy:!1},callback:function(e){this.hook.onGetGeoLocation=this.hook.onGetGeoLocation||[],this.hook.onGetGeoLocationError=this.hook.onGetGeoLocationError||[],this.hook.onBeginWatchGeoLocation=this.hook.onBeginWatchGeoLocation||[],this.hook.onEndWatchGeoLocation=this.hook.onEndWatchGeoLocation||[],MapsGPX.prototype.isSupportedGeoLocation=function(){return navigator.geolocation?!0:!1},MapsGPX.prototype.isWatchingGeoLocation=function(){return MapsGPX.plugin.GeoLocation.watcher?!0:!1},MapsGPX.prototype.beginWatchGeoLocation=function(){var e=null;return MapsGPX.plugin.GeoLocation.watcher?e=!1:(MapsGPX.plugin.GeoLocation.watcher=navigator.geolocation.watchPosition(function(e){0!=this.hook.onGetGeoLocation.length&&this.applyHook("onGetGeoLocation",e)}.bind(this),function(e){console.error(e),0!=this.hook.onGetGeoLocationError.length&&this.applyHook("onGetGeoLocationError",e)}.bind(this),MapsGPX.plugin.GeoLocation.options),e=!0),0!=this.hook.onBeginWatchGeoLocation.length&&this.applyHook("onBeginWatchGeoLocation",e),e},MapsGPX.prototype.endWatchGeoLocation=function(){var e=null;return MapsGPX.plugin.GeoLocation.watcher?(navigator.geolocation.clearWatch(MapsGPX.plugin.GeoLocation.watcher),MapsGPX.plugin.GeoLocation.watcher=null,e=!0):e=!1,0!=this.hook.onEndWatchGeoLocation.length&&this.applyHook("onEndWatchGeoLocation",e),e}}},MapsGPX.plugin.GeoLocationControl={callback:function(e){var t,n,i;return i=function(){this.initialize.apply(this,arguments)},i.prototype={initialize:function(e){e=e||{},this.marker=null,this.circle=null,this.shown=!1},setMap:function(e){return this.marker&&this.marker.setMap(e),this.circle&&this.circle.setMap(e),e?this.shown=!0:this.shown=!1,this},isOverlayed:function(){return this.shown?!0:!1},reset:function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);return this.circle?(this.marker.setPosition(t),this.circle.setCenter(t)):(this.marker=new google.maps.Marker({clickable:!1,
position:t,icon:new google.maps.MarkerImage([MapsGPX.plugin.GeoLocationControl.path,"gpsloc.png"].join("/"),new google.maps.Size(16,16),new google.maps.Point(0,0),new google.maps.Point(8,8))}),this.circle=new google.maps.Circle({center:t,clickable:!1,fillColor:"#CCCCFF",fillOpacity:.2,strokeColor:"#6666CC",strokeOpacity:.6,strokeWeight:2,radius:e.coords.accuracy||1})),t}},t=new i,n=new MapsGPX.MapControl({enabled:[MapsGPX.plugin.GeoLocationControl.path,"ic_location_searching_black_24dp.png"].join("/"),fixed:[MapsGPX.plugin.GeoLocationControl.path,"ic_gps_fixed_red_24dp.png"].join("/"),located:[MapsGPX.plugin.GeoLocationControl.path,"ic_gps_fixed_blue_24dp.png"].join("/"),failed:[MapsGPX.plugin.GeoLocationControl.path,"ic_gps_off_black_24dp.png"].join("/"),disabled:[MapsGPX.plugin.GeoLocationControl.path,"ic_location_disabled_black_24dp.png"].join("/")},{initial:"enabled"}),n.setMap(this.map),this.isSupportedGeoLocation()?(this.register("onBeginWatchGeoLocation",function(e){n.changeIcon("fixed")}.bind(this)),this.register("onEndWatchGeoLocation",function(e){n.changeIcon("enabled"),t.setMap(null)}.bind(this)),this.register("onGetGeoLocation",function(e){var i=t.reset(e);t.isOverlayed()||t.setMap(this.getMap()),n.isCurrentIcon("fixed")&&this.getMap().panTo(i)}.bind(this)),this.register("onGetGeoLocationError",function(e){n.changeIcon("failed"),t.setMap(null)}.bind(this)),google.maps.event.addDomListener(n.getElement(),"click",function(e){this.isWatchingGeoLocation()&&n.isCurrentIcon("fixed")?n.changeIcon("located"):this.isWatchingGeoLocation()?this.endWatchGeoLocation():this.beginWatchGeoLocation()}.bind(this)),void google.maps.event.addDomListener(this.getMap(),"dragstart",function(e){this.isWatchingGeoLocation()&&n.isCurrentIcon("fixed")&&n.changeIcon("located")}.bind(this))):void n.changeIcon("disabled")}},MapsGPX.plugin.InputFileControl={callback:function(e){var t,n;t=new MapsGPX.MapControl({initial:[MapsGPX.plugin.InputFileControl.path,"ic_folder_open_black_24dp.png"].join("/")},{position:"TOP_LEFT"}),t.setMap(this.map),n=document.createElement("input"),n.setAttribute("id",MapsGPX.plugin.InputFileControl.id),n.setAttribute("type","file"),n.setAttribute("style","display:none"),n.setAttribute("multiple",!0),google.maps.event.addDomListener(n,"change",function(e){var t,n,i=e.target.files;for(t=0,n=i.length;n>t;++t)this.input(i[t].name,i[t]).then(function(e){console.log(e)})}.bind(this)),google.maps.event.addDomListener(t.getElement(),"click",function(e){this.click()}.bind(n))}},MapsGPX.plugin.Milestone={bundles:["ExtDraggableObject.js","NodeOverlay.js","DivSign.js"],intervalDefinition:{mapping:{5:4e5,6:3e5,7:2e5,8:1e5,9:1e5,10:5e4,11:5e4,12:2e4,13:2e4,14:1e4,15:1e4,16:2e3,17:2e3,18:1e3,19:1e3},min_zoom:5,max_zoom:20,max_number_of_signs:100,min_interval_meters:100},getInterval:function(e,t){var n,i=MapsGPX.plugin.Milestone.intervalDefinition,o=parseInt(t)<i.max_zoom?i.mapping[t]:i.min_interval_meters,r=parseInt(e)/i.max_number_of_signs;if(r>=o)for(n=t-1;i.min_zoom<=n&&r>=o;--n)o=n<i.max_zoom?i.mapping[n]:i.min_interval_meters;return o},makeMilestones:function(e,t){var n,i,o={},r=e.getPath(),a=t,s=0;for(n=1,i=r.getLength();i>n;++n)s+=google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(r.getAt(n-1).lat(),r.getAt(n-1).lng()),new google.maps.LatLng(r.getAt(n).lat(),r.getAt(n).lng())),s>=a&&(("undefined"==o[a]||null==o[a])&&(o[a]={order:a,index:n,distance:s}),a+=t);return o},callback:function(e){this.context.Milestone={},this.context.Milestone.trkLengthCache={shelf:{},genKey:function(e){return[e.object_id].join("	")},add:function(e,t){return this.shelf[this.genKey(t)]=e,this},get:function(e){return this.shelf[this.genKey(e)]}},this.context.Milestone.signCache={shelf:{},genKey:function(e,t){return[e.object_id,t].join("	")},add:function(e,t,n){return this.shelf[this.genKey(t,n)]=e,this},get:function(e,t){return this.shelf[this.genKey(e,t)]},hideAll:function(){for(var e in this.shelf)this.shelf[e].setMap(null);return this}},this.context.Milestone.stonesCache={shelf:{},genKey:function(e,t){return[e.object_id,t].join("	")},add:function(e,t,n){return this.shelf[this.genKey(t,n)]=e,this},get:function(e,t){return this.shelf[this.genKey(e,t)]}},google.maps.event.addListener(this.getMap(),"zoom_changed",function(){var e=this.getMap().getZoom();this.context.Milestone.signCache.hideAll(),e<MapsGPX.plugin.Milestone.intervalDefinition.min_zoom||this.eachGPX(function(e,t){var n,i,o,r,a,s,l,p;for(n=0,i=e.trk.length;i>n;++n)if(o=e.trk[n],o.overlay){trklength=this.app.context.Milestone.trkLengthCache.get(o.overlay),trklength||(trklength=o.overlay.computeDistanceTrack(0,o.overlay.getPath().getLength()-1),this.app.context.Milestone.trkLengthCache.add(o.overlay,trklength)),l=MapsGPX.plugin.Milestone.getInterval(trklength,this.zoom),a=this.app.context.Milestone.stonesCache.get(o.overlay,l),a||(a=MapsGPX.plugin.Milestone.makeMilestones(o.overlay,l),this.app.context.Milestone.stonesCache.add(a,o.overlay,l)),p=o.overlay.overlayed()?this.app.getMap():null;for(r in a)s=this.app.context.Milestone.signCache.get(o.overlay,a[r].index),s||(s=new NodeOverlay(DivSign.create(parseInt(a[r].distance/1e3)+" km",{contentStyle:{fontSize:"x-small",whiteSpace:"nowrap"}}),{position:o.overlay.getPath().getAt(a[r].index)}),this.app.context.Milestone.signCache.add(s,o.overlay,a[r].index)),s.setMap(p)}}.bind({app:this,zoom:e}))}.bind(this)),this.register("onShowPolyline",function(e){google.maps.event.trigger(this.getMap(),"zoom_changed")}.bind(this)),this.register("onHidePolyline",function(e){google.maps.event.trigger(this.getMap(),"zoom_changed")}.bind(this))}},NodeOverlay=function(e,t){var n=function(e,t){for(var n in t)e[n]=t[n];return e};this["super"]=google.maps.OverlayView.prototype,this.element=e,this["default"]={draggable:!1,anchorPosition:NodeOverlay.AnchorPosition.BOTTOM_CENTER,pane:NodeOverlay.MapPane.OVERLAY_IMAGE,draggableOptions:{}},this.settings=n(this["default"],t||{}),this.position=this.settings.position,this.draggable=null},NodeOverlay.prototype=Object.create(google.maps.OverlayView.prototype,{constructor:{value:NodeOverlay}}),NodeOverlay.NAME="NodeOverlay",NodeOverlay.VERSION="3.0.2",NodeOverlay.AnchorPosition={TOP_LEFT:"topLeft",TOP_RIGHT:"topRight",TOP_CENTER:"topCenter",MIDDLE_LEFT:"middleLeft",MIDDLE_RIGHT:"middleRight",MIDDLE_CENTER:"middleCenter",BOTTOM_LEFT:"bottomLeft",BOTTOM_RIGHT:"bottomRight",BOTTOM_CENTER:"bottomCenter"},NodeOverlay.MapPane={MAP_PANE:"mapPane",OVERLAY_LAYER:"overlayLayer",MARKER_LAYER:"markerLayer",OVERLAY_SHADOW:"overlayShadow",OVERLAY_IMAGE:"overlayImage",FLOAT_SHADOW:"floatShadow",OVERLAY_MOUSE_TARGET:"overlayMouseTarget",FLOAT_PANE:"floatPane"},NodeOverlay._getFunctionToComputeOffset=function(e){var t=function(e){return e/2};xl=function(e){return 0},xr=function(e){return e},yc=function(e){return e/2},yt=function(e){return 0},yb=function(e){return e};var n={};return n[NodeOverlay.AnchorPosition.TOP_LEFT]=function(e){return new google.maps.Size(xl(e.width),yt(e.height))},n[NodeOverlay.AnchorPosition.TOP_RIGHT]=function(e){return new google.maps.Size(xr(e.width),yt(e.height))},n[NodeOverlay.AnchorPosition.TOP_CENTER]=function(e){return new google.maps.Size(t(e.width),yt(e.height))},n[NodeOverlay.AnchorPosition.MIDDLE_LEFT]=function(e){return new google.maps.Size(xl(e.width),yc(e.height))},n[NodeOverlay.AnchorPosition.MIDDLE_RIGHT]=function(e){return new google.maps.Size(xr(e.width),yc(e.height))},n[NodeOverlay.AnchorPosition.MIDDLE_CENTER]=function(e){return new google.maps.Size(t(e.width),yc(e.height))},n[NodeOverlay.AnchorPosition.BOTTOM_LEFT]=function(e){return new google.maps.Size(xl(e.width),yb(e.height))},n[NodeOverlay.AnchorPosition.BOTTOM_RIGHT]=function(e){return new google.maps.Size(xr(e.width),yb(e.height))},n[NodeOverlay.AnchorPosition.BOTTOM_CENTER]=function(e){return new google.maps.Size(t(e.width),yb(e.height))},n[e]},NodeOverlay._createSizeOfElement=function(e){var t=e.style.display;if("none"!=t&&null!=t)return{width:e.offsetWidth,height:e.offsetHeight};var n=e.style,i=n.visibility,o=n.position,r=n.display;n.visibility="hidden",n.position="absolute",n.display="block";var a=e.clientWidth,s=e.clientHeight;return n.display=r,n.position=o,n.visibility=i,new google.maps.Size(a,s)},NodeOverlay.prototype.getOffset=function(e){return NodeOverlay._getFunctionToComputeOffset(e)(NodeOverlay._createSizeOfElement(this.element))},NodeOverlay.prototype.getPane=function(){return this.getPanes()[this.settings.pane]},NodeOverlay.prototype.getPosition=function(){return this.position},NodeOverlay.prototype.getCurrentPoint=function(){var e=this.getOffset(this.settings.anchorPosition);return new google.maps.Point(parseInt(this.element.style.left)+e.width,parseInt(this.element.style.top)+e.height)},NodeOverlay.prototype.setPointByLatLng=function(e){var t=this.getProjection().fromLatLngToDivPixel(e),n=this.getOffset(this.settings.anchorPosition);return t.x=t.x-n.width,t.y=t.y-n.height,this.element.style.left=t.x+"px",this.element.style.top=t.y+"px",t},NodeOverlay.prototype.moveTo=function(e){return this.setPointByLatLng(e),this},NodeOverlay.prototype._handler_mouse_event=function(e){e.latLng=this.getPosition(),google.maps.event.trigger(this,e.type,e)},NodeOverlay.prototype._handler_drag_object_event=function(e){this.position=this.getProjection().fromDivPixelToLatLng(this.getCurrentPoint()),this.settings.marker&&this.settings.marker.setPosition(this.getPosition());var t=e.event.type;"mousedown"==e.event.type?t="dragstart":"mousemove"==e.event.type?t="drag":"mouseup"==e.event.type&&(t="dragend");var n=e.event;n.latLng=this.getPosition(),google.maps.event.trigger(this,t,n)},NodeOverlay.prototype._createDraggableObject=function(){this.draggable=new ExtDraggableObject(this.element,this.settings.draggableOptions),google.maps.event.addDomListener(this.draggable,"dragstart",this._handler_drag_object_event.bind(this)),google.maps.event.addDomListener(this.draggable,"drag",this._handler_drag_object_event.bind(this)),google.maps.event.addDomListener(this.draggable,"dragend",this._handler_drag_object_event.bind(this))},NodeOverlay.prototype.onAdd=function(){this.element.style||(this.element.style={}),this.element.style.position="absolute",this.getPane().appendChild(this.element),this.setPointByLatLng(this.getPosition()),google.maps.event.addDomListener(this.element,"click",this._handler_mouse_event.bind(this)),google.maps.event.addDomListener(this.element,"mousedown",this._handler_mouse_event.bind(this)),google.maps.event.addDomListener(this.element,"mouseup",this._handler_mouse_event.bind(this)),this.settings.draggable&&this._createDraggableObject(),this.settings.marker&&(this.settings.marker.setPosition(this.getPosition()),this.settings.marker.setMap(this.getMap())),this.element.style.visibility="visible"},NodeOverlay.prototype.onRemove=function(){this.settings.marker&&this.settings.marker.setMap(null),this.draggable&&google.maps.event.clearInstanceListeners(this.draggable),google.maps.event.clearInstanceListeners(this.element),this.element.style.visibility="hidden"},NodeOverlay.prototype.draw=function(){this.setPointByLatLng(this.getPosition())},NodeOverlay.prototype.setDraggableCursor=function(e){return this.draggable?(this.draggable.setDraggableCursor(e),!0):!1},NodeOverlay.prototype.setDraggingCursor=function(e){return this.draggable?(this.draggable.setDraggingCursor(e),!0):!1};var DivSign={NAME:"DivSign",VERSION:"3.0.0",createDivWrappingText:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t},create:function(e,t){var n=function(e,t){for(var n in t)e[n]=t[n];return e},i={contentStyle:{},legStyle:{},maxWidth:"400px",opacity:"0.8"},o=n(i,t||{}),r=n({opacity:o.opacity,backgroundColor:"#FFFFFF",padding:"2px 1em",margin:"0",fontSize:"small",border:"1px solid #AAAAAA"},o.contentStyle||{}),a=n({opacity:o.opacity,margin:"0 auto 0 auto",textAlign:"center",backgroundColor:"#FFFFFF",padding:"0",border:"1px solid #AAAAAA",borderTop:"none",width:"3px",height:"5px"},o.legStyle||{}),s=this.createDivWrappingText(e);for(var l in r)s.style[l]=r[l];var p=document.createElement("div");p.style.textAlign="center",p.style.padding="0",p.appendChild(s);var h=document.createElement("div");for(var l in a)h.style[l]=a[l];var c=document.createElement("div");return c.style.overflow="hidden",c.style.width=o.width,o.maxWidth&&(c.style.maxWidth=o.maxWidth,c.style.setExpression&&c.style.setExpression("width",o.maxWidth<document.body.clientWidth?o.maxWidth:"auto")),c.appendChild(p),c.appendChild(h),c}};MapsGPX.plugin.QueryURL={callback:function(e){var t=MapsGPX.parseQueryString(location.search);t.url&&this.input(t.url,t.url)}},MapsGPX.plugin.SearchControl={bundles:["loader.css"],className:"map_control_input",callback:function(e){var t=document.createElement("input");t.setAttribute("class",MapsGPX.plugin.SearchControl.className),t.setAttribute("type","text"),t.setAttribute("placeholder","URL"),this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(t),google.maps.event.addDomListener(t,"change",function(e){var t=e.target.value.trim();""!=t&&this.input(t,t)}.bind(this))}},MapsGPX.plugin.SidePanelControl={templateOfId:"sidepanel",_sequence:0,generateId:function(){return this.templateOfId+""+ ++this._sequence},callback:function(e){var t,n,i;i=e||{effect:"slide",side:"LEFT",span:"75%"},t=new MapsGPX.MapControl({initial:[MapsGPX.plugin.SidePanelControl.path,"ic_list_black_24dp.png"].join("/")},{position:"LEFT_BOTTOM"}),t.setMap(this.map),n=new DrawerCSS(e.base_id||this.getMapElement().getAttribute("id"),e.drawer_id||MapsGPX.plugin.SidePanelControl.generateId(),i),google.maps.event.addDomListener(t.getElement(),"click",function(e){this.toggle()}.bind(n)),google.maps.event.addListener(this.getMap(),"click",function(e){this.close()}.bind(n)),this.context.SidePanelControl=n}},MapsGPX.plugin.ToggleOverlay={bundles:["loader.css"],class_prefix:"toggle-overlay-",callback:function(e){var t,n,i,o,r,a;return this.context.SidePanelControl?(t=function(e,t){var n;return n=document.createElement("input"),n.setAttribute("type","checkbox"),n.setAttribute("value",e),t&&(n.checked=!0),google.maps.event.addDomListener(n,"change",function(e){this.showOverlayGpxs()}.bind(this)),n}.bind(this),n=function(e){var t,n=e.getAttribute("value");return t=document.createElement("label"),t.setAttribute("class",MapsGPX.plugin.ToggleOverlay.class_prefix+n),t.appendChild(e),t.appendChild(document.createTextNode(n)),t}.bind(this),o=t("wpt",!0),r=t("rte",!0),a=t("trk",!0),i=document.createElement("div"),i.setAttribute("class",MapsGPX.plugin.ToggleOverlay.class_prefix+"container"),i.appendChild(n(o)),i.appendChild(n(r)),i.appendChild(n(a)),this.context.SidePanelControl.getElementDrawer().appendChild(i),void this.addFilter("ToggleOverlay","onAppearOverlayShow",function(e,t){return e.isWpt()?this.cb.wpt.checked?!1:!0:e.isRte()?this.cb.rte.checked?!1:!0:e.isTrk()?this.cb.trk.checked?!1:!0:!1}.bind({app:this,cb:{wpt:o,rte:r,trk:a}}))):void console.log('The plugin "ToggleOverlay" requires "SidePanelControl"')}},MapsGPX.plugin.VertexInfo={bundles:["MercatorProjection.js"],indexOfVertexNearestLatlng:function(e,t,n,i){var o,r,a,s,l,p,h,c,u,g,d,f,m,y=6378137,v=y,P=-1,M=5,b=180;for(r=0,a=t.getLength()-1;a>r;++r)o=new google.maps.LatLngBounds,o.extend(t.getAt(r)),o.extend(t.getAt(r+1)),o.extend(MercatorProjection.latlngFromOriginByPixel(e,o.getNorthEast(),M,-M,i)),o.extend(MercatorProjection.latlngFromOriginByPixel(e,o.getSouthWest(),-M,M,i)),o.contains(n)&&(p=t.getAt(r),h=n,c=t.getAt(r+1),u=h.lng()-p.lng(),g=h.lat()-p.lat(),d=c.lng()-p.lng(),f=c.lat()-p.lat(),m=Math.abs(Math.atan2(g,u)-Math.atan2(f,d)),v>m&&(v=m,P=r,b=google.maps.geometry.spherical.computeHeading(t.getAt(r),t.getAt(r+1))));return P>=0&&(s=google.maps.geometry.spherical.computeDistanceBetween(n,t.getAt(P)),l=google.maps.geometry.spherical.computeDistanceBetween(n,t.getAt(P+1)),P=l>s?P:P+1),P},callback:function(e){var t=new MercatorProjection;this.context.VertexInfo={projection:t},this.hook.onVertexInfo=this.hook.onVertexInfo||[],this.register("onCreatePolyline",function(e){e.addListener("click",function(t){var n=MapsGPX.plugin.VertexInfo.indexOfVertexNearestLatlng(this.app.context.VertexInfo.projection,this.polyline.getPath(),t.latLng,this.polyline.getMap().getZoom());0!=this.app.hook.onVertexInfo.length?this.app.applyHook("onVertexInfo",e,n,t):MapsGPX.plugin.VertexInfo._handlerHookOnClickPolylineDefault.call(this.app,e,n,t)}.bind({app:this,polyline:e}))}.bind(this))},_handlerHookOnClickPolylineDefault:function(e,t,n){var i,o;t>=0&&e.isTrk()&&(i=e.getSource()[t],o=["#",t,"<br/>lat=",i.lat,"<br/>lon=",i.lon],i.ele&&o.push("<br/>ele="+i.ele),i.time&&o.push("<br/>time="+i.time),new google.maps.InfoWindow({content:o.join(""),position:e.getPath().getAt(t)}).open(e.getMap()))}},MercatorProjection.TILE_SIZE=256,MercatorProjection.latlngFromOriginByPixel=function(e,t,n,i,o){var r,a,s,l,p,h;return e=e||new MercatorProjection,r=1<<o,a=e.fromLatLngToPoint(t),s=new google.maps.Point(a.x*r,a.y*r),l=new google.maps.Point(Math.floor(s.x/MercatorProjection.TILE_SIZE),Math.floor(s.y/MercatorProjection.TILE_SIZE)),p=a.x+n/r,h=a.y+i/r,e.fromPointToLatLng(new google.maps.Point(p,h))},MercatorProjection.bound=function(e,t,n){return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),e},MercatorProjection.degreesToRadians=function(e){return e*(Math.PI/180)},MercatorProjection.radiansToDegrees=function(e){return e/(Math.PI/180)},MercatorProjection.prototype.fromLatLngToPoint=function(e,t){var n,i;return n=t||new google.maps.Point(0,0),n.x=this.pixelOrigin_.x+e.lng()*this.pixelsPerLonDegree_,i=MercatorProjection.bound(Math.sin(MercatorProjection.degreesToRadians(e.lat())),-.9999,.9999),n.y=this.pixelOrigin_.y+.5*Math.log((1+i)/(1-i))*-this.pixelsPerLonRadian_,n},MercatorProjection.prototype.fromPointToLatLng=function(e){var t,n,i;return t=(e.x-this.pixelOrigin_.x)/this.pixelsPerLonDegree_,n=(e.y-this.pixelOrigin_.y)/-this.pixelsPerLonRadian_,i=MercatorProjection.radiansToDegrees(2*Math.atan(Math.exp(n))-Math.PI/2),new google.maps.LatLng(i,t)},MapsGPX.plugin.VertexInfoWindow={namespace:"VertexInfoWindow",templateOfId:"vertex-info-window-",_sequence:0,generateId:function(){return this.templateOfId+""+ ++this._sequence},pad:function(e,t){return(Math.pow(10,t)+parseInt(e)).toString().slice(-t)},_commify:function(e,t){if(e.match(/\..*\./)||e.match(/,/))return e;for(;t!=(t=t.replace(/^(-?\d+)(\d{3})/,"$1,$2")););return t},commify:function(e){return e.toString().replace(/([0-9\.,]+)/g,MapsGPX.plugin.VertexInfoWindow._commify)},generateContent:function(e,t,n){var i,o="",r="";return t.time&&(i=new Date(t.time),o=[[this.pad(i.getFullYear(),4),this.pad(i.getMonth()+1,2),this.pad(i.getDate(),2)].join("-"),[this.pad(i.getHours(),2),this.pad(i.getMinutes(),2),this.pad(i.getSeconds(),2)].join(":")].join(" ")),t.ele&&(r=parseInt(t.ele)),['<div class="info-window"><div id="',e,'" class="vertex">','  <div class="headline">','    <input type="radio" name="origin" value="',n,'" title="set origin"/> <span class="idx">',n,"</span>","  </div>",'  <div class="complex-type wpt-type">','    <div class="attribute"><span class="latlon lat">',t.lat,'</span>, <span class="latlon lon">',t.lon,"</span></div>",'    <div class="children"><span class="elevation">',r,"m</span></div>",'    <div class="children"><span class="timestamp">',o,"</span></div>","  </div>",'  <div class="measure">',"   &nbsp;","  </div>","</div></div>"].join("")},callback:function(e){this.context.VertexInfoWindow={_active:null,getActiveInfoWindow:function(){return this._active},setActiveInfoWindow:function(e,t){this._active=e,t&&e.setZIndex(this.getHigherZIndex())},isActiveInfoWindow:function(e){return this._active===e},_maxZindex:0,getHigherZIndex:function(){return++this._maxZindex}},google.maps.event.addDomListener(document,"keydown",function(e){var t,n,i=this.context.VertexInfoWindow,o=i.getActiveInfoWindow();if(null!=o){if(t=o.get("VertexInfoWindow"),39==e.keyCode&&t.index<t.polyline.getPath().getLength()-1)t.index+=1;else{if(!(37==e.keyCode&&0<t.index))return;t.index-=1}o.set("VertexInfoWindow",t),n=t.polyline.getPath().getAt(t.index),e.shiftKey&&t.polyline.getMap().panTo(n),o.setPosition(n),o.setContent(MapsGPX.plugin.VertexInfoWindow.generateContent(t.id,t.polyline.getSource()[t.index],t.index))}}.bind(this)),this.register("onVertexInfo",function(e,t,n){var i,o,r=this.context.VertexInfoWindow;t>=0&&e.isTrk()&&(i=MapsGPX.plugin.VertexInfoWindow.generateId(),o=new google.maps.InfoWindow({content:MapsGPX.plugin.VertexInfoWindow.generateContent(i,e.getSource()[t],t),position:e.getPath().getAt(t)}),o.set("VertexInfoWindow",{context:r,id:i,index:t,polyline:e}),google.maps.event.addListener(o,"domready",function(t){var n,i,o,r,a,s,l,p,h,c,u=document.getElementById(this.get("VertexInfoWindow").id),g=this.get("VertexInfoWindow").context,d=null;for(g.setActiveInfoWindow(this,!0),google.maps.event.addDomListener(u,"click",function(e){this.get("VertexInfoWindow").context.setActiveInfoWindow(this,!0)}.bind(this)),n=document.getElementsByClassName("vertex"),o=0,r=n.length;r>o;++o)if(i=n.item(o).getElementsByTagName("input").item(0),"radio"==i.type&&i.checked){d=i.value;break}d&&u!==n.item(o)&&(a=u.getElementsByTagName("input").item(0).value,s=e.computeDistanceTrack(d,a),l="",p="",h=this.get("VertexInfoWindow").polyline.getSource(),c="",h[d].time&&h[a].time&&(c=(new Date(h[a].time)-new Date(h[d].time))/1e3,l=Math.round(c/60),p=0!=c?Math.abs(Math.round(s/1e3/(c/60/60)*10)/10).toString()+" km/h":"0 km/h"),u.getElementsByClassName("measure").item(0).innerHTML=[MapsGPX.plugin.VertexInfoWindow.commify(Math.round(s))," meters",l," mins",p].join(", "))}),google.maps.event.addListener(o,"closeclick",function(){this.get("VertexInfoWindow").context.isActiveInfoWindow(this)&&this.get("VertexInfoWindow").context.setActiveInfoWindow(null),this.set("VertexInfoWindow",null),google.maps.event.clearInstanceListeners(this)}),o.open(e.getMap()))})}};